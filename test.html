<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>My page title</title>
    <link rel="stylesheet" href="">
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body>
    <button id="my-btn">CLICK</button>
    <p class="output">iFrame body</p>
    <h3 class="post">Channel messaging is mainly useful in cases where you've got a social site that embeds capabilities
        from other
        sites into its main interface via iframes, such as games, address book, or an audio player with personalized
        music choices. When these act as standalone units, things are OK, but the difficulty comes when you want
        interaction between the main site and the IFrames, or the different IFrames. For example, what if you wanted to
        add a contact to the address book from the main site, add high scores from your game into your main profile, or
        add new background music choices from the audio player onto the game? Such things are not so easy using
        conventional web technology, because of the security models the web uses. You have to think about whether the
        origins trust one another, and how the messages are passed.</h3>
</body>
<script>
    var output = document.querySelector('.output');


    document.getElementById('my-btn').addEventListener('click', handleButtonClick, false);
    function handleButtonClick(e) {
        window.parent.dispatchEvent(myEvent)
    }
    window.addEventListener('message', onMessage);
    let answer;
    function onMessage(e) {
        output.innerHTML = e.data;
        const post = document.querySelector('.post')

        answer = (msg) => e.ports[0].postMessage(msg)
        // Use the transfered port to post a message back to the main frame
        e.ports[0].postMessage({
            width: post.clientWidth,
            height: post.clientHeight,
        });
    }

    setTimeout(() => {
        answer?.({ width: 100, height: 100 })
    }, 3000)
</script>

</html>